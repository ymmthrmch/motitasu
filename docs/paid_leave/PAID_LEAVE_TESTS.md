# 有給休暇付与テストケース仕様書

## 計算ルールの明確化

### 出勤率計算における端数処理
- **所定労働日数**: 小数点以下切り捨て（例: 129.28 → 129日）
- **出勤率**: 小数点以下はそのまま保持、判定は80.0%以上（80.0%を含む）
- **境界値**: 出勤率が正確に80.0%となる最小出勤日数を境界とする

### 付与日計算ルール
- 初回付与日: 入社日から6か月後（月単位で計算）
- 2回目以降: 初回付与日から1年ごと（年単位で計算）
- 存在しない日付は月末に繰り下げ

## テストケースカテゴリ

### 1. 基本的な付与テスト（週5日勤務）

#### テストケース1-1: 初回付与（6か月後）- 付与成功
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日 = 入社日 + 6か月）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130 → 130日
- **出勤日数**: 104日（実出勤104日）
- **出勤率**: 104 ÷ 130 = 0.800（80.0%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日（勤続0.5年）
- **備考**: 初回付与の標準的なケース

#### テストケース1-2: 2回目付与（1年6か月後）- 付与成功
- **入社日**: 2023年1月1日
- **付与日**: 2024年7月1日（2回目付与日 = 初回付与日2023年7月1日 + 1年）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間、うるう年含む）
- **週所定労働日数**: 5日
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日（小数点以下切り捨て）
- **出勤日数**: 210日（実出勤200日 + 有給10日）
- **出勤率**: 210 ÷ 261 = 0.8045...（80.45...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 11日（勤続1.5年）
- **備考**: 2回目付与の標準的なケース

#### テストケース1-3: 3回目付与（2年6か月後）- 付与成功
- **入社日**: 2022年1月1日
- **付与日**: 2024年7月1日（3回目付与日 = 初回付与日2022年7月1日 + 2年）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間、うるう年含む）
- **週所定労働日数**: 5日
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日（小数点以下切り捨て）
- **出勤日数**: 240日（実出勤225日 + 有給15日）
- **出勤率**: 240 ÷ 261 = 0.9195（91.95%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 12日（勤続2.5年）
- **備考**: 3回目付与の標準的なケース

#### テストケース1-4: 7回目以降付与（6年6か月後）- 上限到達
- **入社日**: 2018年1月1日
- **付与日**: 2024年7月1日（7回目付与日）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日
- **出勤日数**: 250日（実出勤230日 + 有給20日）
- **出勤率**: 250 ÷ 261 = 0.9578...（95.78...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 20日（上限）
- **備考**: 7回目以降は常に20日付与

### 2. 出勤率による付与判定テスト

#### テストケース2-1: 出勤率ちょうど80.0% - 付与成功（境界値）
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130 → 130日
- **必要最小出勤日数**: 130 × 0.8 = 104 → 104日必要（80.0%以上を満たすため）
- **出勤日数**: 104日（実出勤104日）
- **出勤率**: 104 ÷ 130 = 0.8000（80.00%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 80.0%を満たす最小出勤日数での境界値テスト

#### テストケース2-2: 出勤率79.8% - 付与失敗（境界値）
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130 → 130日
- **出勤日数**: 103日（実出勤103日）
- **出勤率**: 103 ÷ 130 = 0.7923...（79.23...%）
- **付与可否**: 付与しない（80%未満）
- **付与日数**: 0日
- **備考**: 1日不足で80%に届かない境界値テスト

#### テストケース2-3: 出勤率50% - 付与失敗
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130 → 130日
- **出勤日数**: 65日（実出勤65日）
- **出勤率**: 65 ÷ 130 = 0.500（50.0%）
- **付与可否**: 付与しない（80%未満）
- **付与日数**: 0日
- **備考**: 明らかに出勤率が低いケース

### 3. 週所定労働日数別テスト

#### テストケース3-1: 週4日勤務 - 初回付与
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 4日
- **所定労働日数**: 182 ÷ 7 × 4 = 104 → 104日
- **出勤日数**: 85日（実出勤85日）
- **出勤率**: 85 ÷ 104 = 0.817...（81.7...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 7日
- **備考**: 週4日勤務の初回付与

#### テストケース3-2: 週3日勤務 - 初回付与
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 3日
- **所定労働日数**: 182 ÷ 7 × 3 = 78 → 78日
- **出勤日数**: 63日（実出勤62日 + 有給1日）
- **出勤率**: 63 ÷ 78 = 0.807...（80.7...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 5日
- **備考**: 週3日勤務の初回付与（ドキュメントの例と同じ）

#### テストケース3-3: 週2日勤務 - 初回付与
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 2日
- **所定労働日数**: 182 ÷ 7 × 2 = 52 → 52日
- **出勤日数**: 42日（実出勤42日）
- **出勤率**: 42 ÷ 52 = 0.807...（80.7...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 3日
- **備考**: 週2日勤務の初回付与

#### テストケース3-4: 週1日勤務 - 初回付与
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 1日
- **所定労働日数**: 182 ÷ 7 × 1 = 26 → 26日
- **出勤日数**: 21日（実出勤21日）
- **出勤率**: 21 ÷ 26 = 0.807...（80.7...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 1日
- **備考**: 週1日勤務の初回付与

#### テストケース3-5: 週4日勤務 - 7回目付与（上限）
- **入社日**: 2018年1月1日
- **付与日**: 2024年7月1日（7回目付与日）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間）
- **週所定労働日数**: 4日
- **所定労働日数**: 366 ÷ 7 × 4 = 209.14... → 209日
- **出勤日数**: 180日（実出勤165日 + 有給15日）
- **出勤率**: 180 ÷ 209 = 0.861（86.1%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 15日（週4日勤務の上限）
- **備考**: 週4日勤務の7回目以降の上限確認

#### テストケース3-6: 週3日勤務 - 7回目付与（上限）
- **入社日**: 2018年1月1日
- **付与日**: 2024年7月1日（7回目付与日）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間）
- **週所定労働日数**: 3日
- **所定労働日数**: 366 ÷ 7 × 3 = 156.85... → 156日
- **出勤日数**: 140日（実出勤130日 + 有給10日）
- **出勤率**: 140 ÷ 156 = 0.897（89.7%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 11日（週3日勤務の上限）
- **備考**: 週3日勤務の7回目以降の上限確認

#### テストケース3-7: 週2日勤務 - 7回目付与（上限）
- **入社日**: 2018年1月1日
- **付与日**: 2024年7月1日（7回目付与日）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間）
- **週所定労働日数**: 2日
- **所定労働日数**: 366 ÷ 7 × 2 = 104.57... → 104日
- **出勤日数**: 90日（実出勤83日 + 有給7日）
- **出勤率**: 90 ÷ 104 = 0.865（86.5%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 7日（週2日勤務の上限）
- **備考**: 週2日勤務の7回目以降の上限確認

#### テストケース3-8: 週1日勤務 - 7回目付与（上限）
- **入社日**: 2018年1月1日
- **付与日**: 2024年7月1日（7回目付与日）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間）
- **週所定労働日数**: 1日
- **所定労働日数**: 366 ÷ 7 × 1 = 52.28... → 52日
- **出勤日数**: 45日（実出勤42日 + 有給3日）
- **出勤率**: 45 ÷ 52 = 0.865（86.5%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 3日（週1日勤務の上限）
- **備考**: 週1日勤務の7回目以降の上限確認

### 4. 特殊な日付処理テスト

#### テストケース4-1: 月末入社（8月31日）- 2月への繰り下げ
- **入社日**: 2023年8月31日
- **付与日**: 2024年2月29日（初回付与日、うるう年）
- **判定対象期間**: 2023年8月31日〜2024年2月28日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130日
- **出勤日数**: 105日（実出勤105日）
- **出勤率**: 105 ÷ 130 = 0.8076...（80.76...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 8月31日の6か月後は2月31日だが存在しないため2月29日（うるう年）

#### テストケース4-2: 月末入社（8月31日）- 平年の2月への繰り下げ
- **入社日**: 2024年8月31日
- **付与日**: 2025年2月28日（初回付与日、平年）
- **判定対象期間**: 2024年8月31日〜2025年2月27日（181日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 181 ÷ 7 × 5 = 129.28... → 129日
- **出勤日数**: 110日（実出勤110日）
- **出勤率**: 110 ÷ 129 = 0.8527...（85.27...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 8月31日の6か月後は2月31日だが存在しないため2月28日（平年）

#### テストケース4-3: 2月29日入社 - 翌年の付与日
- **入社日**: 2024年2月29日（うるう年）
- **付与日**: 2024年8月29日（初回付与日）
- **判定対象期間**: 2024年2月29日〜2024年8月28日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130日
- **出勤日数**: 108日（実出勤108日）
- **出勤率**: 108 ÷ 130 = 0.8307...（83.07...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 2月29日の6か月後は8月29日

#### テストケース4-4: 2月29日付与日 - 平年への移行
- **入社日**: 2023年8月31日
- **付与日1回目**: 2024年2月29日（うるう年）
- **付与日2回目**: 2025年2月28日（平年、2024年2月29日の1年後）
- **判定対象期間**: 2024年2月29日〜2025年2月27日（365日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 365 ÷ 7 × 5 = 260.71... → 260日
- **出勤日数**: 210日（実出勤200日 + 有給10日）
- **出勤率**: 210 ÷ 260 = 0.8076...（80.76...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 11日
- **備考**: うるう年の2月29日から平年の2月28日への移行

#### テストケース4-5: 1月31日入社 - 7月31日への付与
- **入社日**: 2024年1月31日
- **付与日**: 2024年7月31日（初回付与日）
- **判定対象期間**: 2024年1月31日〜2024年7月30日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130 → 130日
- **出勤日数**: 105日（実出勤105日）
- **出勤率**: 105 ÷ 130 = 0.8076...（80.76...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 31日入社で31日が存在する月への付与

#### テストケース4-6: 3月31日入社 - 9月30日への繰り下げ
- **入社日**: 2024年3月31日
- **付与日**: 2024年9月30日（初回付与日、9月31日は存在しないため）
- **判定対象期間**: 2024年3月31日〜2024年9月29日（183日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 183 ÷ 7 × 5 = 130.71... → 130日
- **出勤日数**: 106日（実出勤106日）
- **出勤率**: 106 ÷ 130 = 0.815（81.5%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 3月31日の6か月後は9月31日だが存在しないため9月30日に繰り下げ

#### テストケース4-7: 非うるう年入社→うるう年付与
- **入社日**: 2023年8月29日
- **付与日1回目**: 2024年2月29日（初回付与日、うるう年）
- **判定対象期間**: 2023年8月29日〜2024年2月28日（184日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 184 ÷ 7 × 5 = 131.42... → 131日
- **出勤日数**: 106日（実出勤106日）
- **出勤率**: 106 ÷ 131 = 0.809（80.9%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 平年から翌年のうるう年への付与

### 5. 有給休暇の消化を含む出勤率計算テスト

#### テストケース5-1: 有給休暇取得により80%達成
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130 → 130日
- **実際の出勤日数**: 95日
- **有給休暇取得日数**: 9日
- **出勤日数（計算用）**: 95 + 9 = 104日
- **出勤率**: 104 ÷ 130 = 0.800（80.0%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 有給休暇を含めて初めて80%を超えるケース

#### テストケース5-2: 有給休暇を大量に取得
- **入社日**: 2023年1月1日
- **付与日**: 2024年7月1日（2回目付与日）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日
- **実際の出勤日数**: 200日
- **有給休暇取得日数**: 20日（初回付与の10日を全消化 + 繰越分10日）
- **出勤日数（計算用）**: 200 + 20 = 220日
- **出勤率**: 220 ÷ 261 = 0.842（84.2%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 11日
- **備考**: 有給を多く取得しているケース

### 6. 長期勤続テスト

#### テストケース6-1: 勤続10年
- **入社日**: 2014年4月1日
- **付与日**: 2024年10月1日（11回目付与日）
- **判定対象期間**: 2023年10月1日〜2024年9月30日（366日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日
- **出勤日数**: 250日（実出勤230日 + 有給20日）
- **出勤率**: 250 ÷ 261 = 0.957（95.7%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 20日（上限）
- **備考**: 長期勤続者の付与

#### テストケース6-2: 勤続20年
- **入社日**: 2004年6月30日
- **付与日**: 2024年12月30日（21回目付与日、初回付与日が2004年12月30日）
- **判定対象期間**: 2023年12月30日〜2024年12月29日（366日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日
- **出勤日数**: 255日（実出勤235日 + 有給20日）
- **出勤率**: 255 ÷ 261 = 0.977（97.7%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 20日（上限）
- **備考**: 超長期勤続者の付与

### 7. 年末年始をまたぐケース

#### テストケース7-1: 年末入社 - 翌年への付与
- **入社日**: 2023年12月31日
- **付与日**: 2024年6月30日（初回付与日）
- **判定対象期間**: 2023年12月31日〜2024年6月29日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130日
- **出勤日数**: 105日（実出勤105日）
- **出勤率**: 105 ÷ 130 = 0.807（80.7%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 年をまたいだ付与判定

#### テストケース7-2: 1月1日入社
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130 → 130日
- **出勤日数**: 120日（実出勤120日）
- **出勤率**: 120 ÷ 130 = 0.9230...（92.30...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 年初入社の標準ケース

### 8. 再判定テストケース

#### テストケース8-1: 過去の打刻修正で付与から不付与へ
- **入社日**: 2024年1月1日
- **初回判定日**: 2024年7月1日
- **初回判定時の出勤日数**: 104日
- **初回判定結果**: 付与（10日）
- **修正日**: 2024年8月1日
- **修正内容**: 2024年6月15日の出勤記録を削除
- **修正後の出勤日数**: 103日
- **修正後の出勤率**: 103 ÷ 130 = 0.7923...（79.23...%）
- **再判定結果**: 付与取消（80%未満）
- **有給使用状況**: 未使用
- **最終有給残日数**: 0日
- **備考**: 付与が取り消されるケース

#### テストケース8-2: 過去の打刻修正で不付与から付与へ
- **入社日**: 2024年1月1日
- **初回判定日**: 2024年7月1日
- **初回判定時の出勤日数**: 103日
- **初回判定結果**: 不付与（80%未満）
- **修正日**: 2024年8月1日
- **修正内容**: 2024年6月15日の出勤記録を追加
- **修正後の出勤日数**: 104日
- **修正後の出勤率**: 104 ÷ 129 = 0.806（80.6%）
- **再判定結果**: 付与（10日）
- **備考**: 後から付与されるケース

#### テストケース8-3: 付与取消で有給がマイナスになるケース
- **入社日**: 2024年1月1日
- **初回判定日**: 2024年7月1日
- **初回付与**: 10日
- **有給使用**: 2024年7月15日〜7月25日で8日使用
- **修正日**: 2024年8月1日
- **修正内容**: 2024年5月の出勤記録5日分を削除
- **修正後の出勤日数**: 99日
- **修正後の出勤率**: 99 ÷ 129 = 0.767（76.7%）
- **再判定結果**: 付与取消
- **計算上の有給残日数**: -8日（0日 - 8日使用）
- **最終有給残日数**: 0日（マイナスは0に調整）
- **備考**: マイナスになる場合は0日に調整

#### テストケース8-4: 複数回の付与に影響する修正
- **入社日**: 2023年1月1日
- **1回目付与日**: 2023年7月1日（付与：10日）
- **2回目付与日**: 2024年7月1日
- **修正日**: 2024年8月1日
- **修正内容**: 2024年6月の出勤記録2日分を削除
- **1回目判定**: 変更なし（判定対象期間外）
- **2回目判定対象期間**: 2023年7月1日〜2024年6月30日
- **修正前の出勤日数**: 210日
- **修正後の出勤日数**: 208日
- **修正後の出勤率**: 208 ÷ 261 = 0.796（79.6%）
- **2回目再判定結果**: 付与取消（11日→0日）
- **備考**: 直近の付与のみ再判定

### 9. 境界値・エッジケーステスト

#### テストケース9-1: うるう年の366日間判定
- **入社日**: 2023年7月1日
- **付与日**: 2024年1月1日（初回付与日）
- **判定対象期間**: 2023年7月1日〜2023年12月31日（184日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 184 ÷ 7 × 5 = 131.42... → 131日
- **出勤日数**: 106日
- **出勤率**: 106 ÷ 131 = 0.809（80.9%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 期間の日数計算確認

#### テストケース9-2: 所定労働日数の小数点切り捨て確認
- **入社日**: 2024年1月15日
- **付与日**: 2024年7月15日（初回付与日）
- **判定対象期間**: 2024年1月15日〜2024年7月14日（182日間）
- **週所定労働日数**: 3日
- **所定労働日数計算**: 182 ÷ 7 × 3 = 78.0（ちょうど整数）
- **所定労働日数**: 78日
- **出勤日数**: 63日
- **出勤率**: 63 ÷ 78 = 0.807（80.7%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 5日
- **備考**: 所定労働日数が整数になるケース

#### テストケース9-3: 最小勤務パターン（週1日）の境界値
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 1日
- **所定労働日数**: 182 ÷ 7 × 1 = 26 → 26日
- **出勤日数**: 21日
- **出勤率**: 21 ÷ 26 = 0.8076...（80.76...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 1日
- **備考**: 最小の労働日数での境界値

### 10. 複雑な継続勤務年数のケース

#### テストケース10-1: 4回目付与（3年6か月後）
- **入社日**: 2021年1月1日
- **付与日**: 2024年7月1日（4回目付与日）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日
- **出勤日数**: 230日（実出勤216日 + 有給14日）
- **出勤率**: 230 ÷ 261 = 0.881（88.1%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 14日
- **備考**: 4回目の付与確認

#### テストケース10-2: 5回目付与（4年6か月後）
- **入社日**: 2020年1月1日
- **付与日**: 2024年7月1日（5回目付与日）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日
- **出勤日数**: 235日（実出勤219日 + 有給16日）
- **出勤率**: 235 ÷ 261 = 0.900（90.0%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 16日
- **備考**: 5回目の付与確認

#### テストケース10-3: 6回目付与（5年6か月後）
- **入社日**: 2019年1月1日
- **付与日**: 2024年7月1日（6回目付与日）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日
- **出勤日数**: 240日（実出勤222日 + 有給18日）
- **出勤率**: 240 ÷ 261 = 0.919（91.9%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 18日
- **備考**: 6回目の付与確認

### 11. 有給休暇の消化で出勤率80%未満になるケース

#### テストケース11-1: 有給消化により付与取消相当の出勤率
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130 → 130日
- **実際の出勤日数**: 75日
- **有給休暇取得日数**: 25日（過去に付与された分）
- **出勤日数（計算用）**: 75 + 25 = 100日
- **出勤率**: 100 ÷ 130 = 0.7692...（76.92...%）
- **付与可否**: 付与しない（80%未満）
- **付与日数**: 0日
- **備考**: 有給を多く取得しても80%に達しないケース

### 12. 週6日勤務（週5日以上）テスト

#### テストケース12-1: 週6日勤務 - 初回付与（上限20日）
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 6日
- **所定労働日数**: 182 ÷ 7 × 6 = 156 → 156日
- **出勤日数**: 130日（実出勤130日）
- **出勤率**: 130 ÷ 156 = 0.8333...（83.33...%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日（勤続0.5年、週5日以上は通常の労働者テーブル適用）
- **備考**: 週6日勤務も週5日以上として扱う

### 13. 極端な境界値・エッジケーステスト

#### テストケース13-1: 週0日勤務（休職中）
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与日）
- **判定対象期間**: 2024年1月1日〜2024年6月30日（182日間）
- **週所定労働日数**: 0日
- **所定労働日数**: 182 ÷ 7 × 0 = 0日
- **出勤日数**: 0日
- **出勤率**: 計算不可（分母が0）
- **付与可否**: 付与しない（計算不可）
- **付与日数**: 0日
- **備考**: 休職等で所定労働日数が0の場合

### 14. 退職・中途離職テスト

#### テストケース14-1: 付与日前の退職
- **入社日**: 2024年1月1日
- **予定付与日**: 2024年7月1日（初回付与日）
- **退職日**: 2024年6月15日
- **判定対象期間**: なし（付与日に在籍していない）
- **付与可否**: 付与しない（退職済み）
- **付与日数**: 0日
- **備考**: 付与日前に退職した場合は判定対象外


### 15. 有効期限・時効消滅テスト

#### テストケース15-1: 2年後の有効期限切れ
- **入社日**: 2022年1月1日
- **初回付与日**: 2022年7月1日（10日付与）
- **有効期限**: 2024年7月1日（付与日から2年後）
- **消滅日**: 2024年7月1日
- **残日数変化**: 10日 → 0日（時効消滅）
- **備考**: 未使用の有給は2年で時効消滅

#### テストケース15-2: 複数年度の有給が混在する場合の消滅順序
- **入社日**: 2021年1月1日
- **1回目付与**: 2021年7月1日（10日付与、有効期限：2023年7月1日）
- **2回目付与**: 2022年7月1日（11日付与、有効期限：2024年7月1日）
- **使用順序**: 古い付与分から消化（2021年付与分を先に使用）
- **2023年7月1日時点**: 1回目付与分のうち未使用分が時効消滅
- **備考**: 複数年度の有給は付与日の古い順に使用・消滅

### 16. 再判定の複雑なケース

#### テストケース16-1: 修正日が直近付与日より後の場合（再判定なし）
- **入社日**: 2024年1月1日
- **付与日**: 2024年7月1日（初回付与、10日付与）
- **修正日**: 2024年8月1日
- **修正内容**: 2024年7月15日の出勤記録を追加
- **再判定**: 実施しない（修正日が直近付与日より後のため）
- **最終有給日数**: 10日（変更なし）
- **備考**: 修正日が付与日以降の場合は再判定対象外

#### テストケース16-2: 再判定で上限日数に達している場合
- **入社日**: 2018年1月1日
- **週所定勤務日数**: 5日
- **付与日**: 2024年7月1日（7回目付与、20日付与）
- **判定対象期間**: 2023年7月1日〜2024年6月30日（366日）
- **所定労働日数**: 366 ÷ 7 × 5 = 261.42... → 261日
- **修正日**: 2024年8月1日
- **修正内容**: 2024年6月の出勤記録5日分を追加
- **修正前の出勤日数**: 209日
- **修正前の出勤率**: 80.07...%
- **修正後の出勤日数**: 214日
- **修正後の出勤率**: 81.99...%
- **再判定結果**: 20日付与（変更なし、既に上限）
- **備考**: 再判定でも上限は変わらない

### 17. 複雑な日付・年次遷移テスト

#### テストケース17-1: うるう年の複雑な遷移（4年サイクル）
- **入社日**: 2020年2月29日（うるう年）
- **1回目付与日**: 2020年8月29日
- **2回目付与日**: 2021年8月29日
- **3回目付与日**: 2022年8月29日
- **4回目付与日**: 2023年8月29日
- **5回目付与日**: 2024年8月29日（次のうるう年）
- **備考**: うるう年をまたぐ長期的な付与日計算

#### テストケース17-2: 年末年始をまたぐ複雑なケース
- **入社日**: 2023年11月1日
- **付与日**: 2024年5月1日（初回付与日）
- **判定対象期間**: 2023年11月1日〜2024年4月30日（182日間）
- **年をまたぐ日数**: 61日（2023年分）+ 121日（2024年分）
- **週所定労働日数**: 5日
- **所定労働日数**: 182 ÷ 7 × 5 = 130日
- **出勤日数**: 108日
- **出勤率**: 108 ÷ 130 = 0.831（83.1%）
- **付与可否**: 付与する（80%以上）
- **付与日数**: 10日
- **備考**: 年をまたぐ6か月間の判定

## テスト実施における注意事項

1. **所定労働日数の計算**：必ず小数点以下を切り捨てること
2. **出勤率の計算**：小数点以下はそのまま保持し、80.0%ちょうどを含めて判定
3. **月単位の計算**：日数ではなく月単位で計算し、存在しない日は月末に繰り下げ
4. **有給休暇の出勤日数算入**：有給休暇取得日は出勤日数に含める
5. **再判定**：修正日が直近の付与日より前の場合のみ実施
6. **付与日数の上限**：週5日以上は20日、週4日は15日、週3日は11日、週2日は7日、週1日は3日が上限

## 実装すべき機能

1. **付与日計算機能**
   - 入社日から付与日を正確に計算（月単位）
   - 月末調整の処理（存在しない日付の繰り下げ）
   - うるう年対応
   - 2回目以降は初回付与日を基準とした年単位計算

2. **出勤率計算機能**
   - 所定労働日数の計算（小数点以下切り捨て）
   - 出勤日数の計算（実出勤 + 有給休暇取得日）
   - 出勤率の計算（小数点保持）と80%判定
   - 週0日勤務等の例外ケース処理

3. **付与日数決定機能**
   - 週所定労働日数別のテーブル参照
   - 継続勤務年数に応じた付与日数
   - 上限日数の適用（週5日以上：20日、週4日：15日、週3日：11日、週2日：7日、週1日：3日）
   - 週6日以上勤務は週5日以上として扱う

4. **再判定機能**
   - 打刻修正時の自動再判定（修正日が直近付与日より前の場合のみ）
   - 付与取消時の残日数調整（マイナスは0に調整）
   - 複数回の付与への影響確認
   - 上限到達時の処理

5. **有効期限管理機能**
   - 2年間の有効期限管理（年単位計算）
   - 期限切れの自動削除
   - 複数年度の有給混在時の使用順序管理（古い付与分から消化）

6. **特殊ケース処理機能**
   - 退職者への付与処理
   - 週0日勤務等の計算不可ケース
   - 判定期間が極端に短い場合の処理
   - 部分出勤（半日勤務等）の扱い

7. **エラーハンドリング機能**
   - 不正な入力データの検証
   - 計算不可能な条件の検出
   - 例外的なケースのログ出力

## テストケース実行時の検証ポイント

1. **境界値テスト**：80.0%ジャストでの付与可否
2. **計算精度**：小数点処理の正確性
3. **日付計算**：月末・うるう年の適切な処理
4. **上限値テスト**：各労働日数での上限到達確認
5. **例外処理**：計算不可能なケースの適切な処理
6. **再判定ロジック**：条件に応じた正確な再判定実行
7. **データ整合性**：有給残日数の整合性維持

このテストケース仕様書は、有給休暇付与スクリプトの実装において、法律要件を満たしつつ、実務で発生しうる全てのパターンを網羅することを目的としています。