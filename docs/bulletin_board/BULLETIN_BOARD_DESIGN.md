# ä¼è¨€æ¿æ©Ÿèƒ½ è¨­è¨ˆæ›¸

## æ¦‚è¦
ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã‚Œã‚’é–²è¦§ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ãã‚‹ä¼è¨€æ¿æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

## æ©Ÿèƒ½è¦ä»¶

### 1. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿æ©Ÿèƒ½
- ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã§ãã‚‹
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æœ€æ–°é †ã§ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
- æŠ•ç¨¿è€…åã¨ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–²è¦§æ©Ÿèƒ½  
- ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é–²è¦§ã§ãã‚‹
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ã¯ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
- æœ€æ–°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹
- ãƒ”ãƒ³ç•™ã‚ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ä¸Šéƒ¨ã«å›ºå®šè¡¨ç¤ºã•ã‚Œã‚‹

### 3. ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¹ã‚¿ãƒ³ãƒ—ï¼‰ã‚’ä»˜ã‘ã‚‰ã‚Œã‚‹
- ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®é¡ï¼šğŸ‘ï¼ˆã„ã„ã­ï¼‰ã€â¤ï¸ï¼ˆãƒãƒ¼ãƒˆï¼‰ã€ğŸ˜‚ï¼ˆç¬‘ã„ï¼‰ã€ğŸ˜®ï¼ˆé©šãï¼‰
- ç®¡ç†è€…ã¯ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®é¡ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§è¿½åŠ ã‚‚å¯èƒ½
- åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯åŒä¸€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¯¾ã—ã¦å„ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®é¡ã‚’1å›ã®ã¿è¨­å®šå¯èƒ½
- ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ä¸€ç·’ã«è¡¨ç¤ºã•ã‚Œã‚‹
- ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’è¡¨ç¤ºã§ãã‚‹

### 4. ãƒ”ãƒ³ç•™ã‚æ©Ÿèƒ½
- ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªèº«ã®æŠ•ç¨¿ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ”ãƒ³ç•™ã‚ã§ãã‚‹
- ãƒ”ãƒ³ç•™ã‚æœŸé–“ï¼š12æ™‚é–“ã€24æ™‚é–“ã€1é€±é–“ã®3ã¤ã‹ã‚‰é¸æŠå¯èƒ½
- ãƒ”ãƒ³ç•™ã‚ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯é€šå¸¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ˆã‚Šä¸Šéƒ¨ã«å›ºå®šè¡¨ç¤ºã•ã‚Œã‚‹
- ãƒ”ãƒ³ç•™ã‚ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åŒå£«ã®è¡¨ç¤ºé †åºï¼š
  - å›ºå®šæ™‚é–“ãŒé•·ã„ã‚‚ã®ã‚’å„ªå…ˆï¼ˆ1é€±é–“ > 24æ™‚é–“ > 12æ™‚é–“ï¼‰
  - å›ºå®šæ™‚é–“ãŒåŒã˜å ´åˆã¯ã€ãƒ”ãƒ³ç•™ã‚ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒå¾Œã®ã‚‚ã®ã‚’å„ªå…ˆ
- ãƒ”ãƒ³ç•™ã‚æœŸé–“çµ‚äº†å¾Œã¯è‡ªå‹•çš„ã«é€šå¸¸è¡¨ç¤ºã«æˆ»ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ”ãƒ³ç•™ã‚ã‚’è§£é™¤ã§ãã‚‹

### 5. æ¨©é™ç®¡ç†
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŠ•ç¨¿ï¼šãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é–²è¦§ï¼šãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
- ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼šãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
- ãƒ”ãƒ³ç•™ã‚ï¼šæŠ•ç¨¿è€…æœ¬äººã®ã¿ï¼ˆè‡ªåˆ†ã®æŠ•ç¨¿ã®ã¿ï¼‰
- ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼šç®¡ç†è€…ã®ã¿

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ

### 1. Message ãƒ¢ãƒ‡ãƒ«
```python
class Message(models.Model):
    """ä¼è¨€æ¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"""
    
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='messages',
        verbose_name='æŠ•ç¨¿è€…'
    )
    content = models.TextField(
        verbose_name='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹',
        max_length=200,
        help_text='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§200æ–‡å­—ï¼‰'
    )
    is_pinned = models.BooleanField(
        verbose_name='ãƒ”ãƒ³ç•™ã‚',
        default=False,
        help_text='ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãƒ”ãƒ³ç•™ã‚ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹'
    )
    pin_duration_hours = models.PositiveIntegerField(
        verbose_name='ãƒ”ãƒ³ç•™ã‚æœŸé–“ï¼ˆæ™‚é–“ï¼‰',
        null=True,
        blank=True,
        choices=[
            (12, '12æ™‚é–“'),
            (24, '24æ™‚é–“'),
            (168, '1é€±é–“'),  # 7æ—¥ Ã— 24æ™‚é–“ = 168æ™‚é–“
        ],
        help_text='ãƒ”ãƒ³ç•™ã‚æœŸé–“ã‚’æ™‚é–“å˜ä½ã§æŒ‡å®š'
    )
    pinned_at = models.DateTimeField(
        verbose_name='ãƒ”ãƒ³ç•™ã‚æ—¥æ™‚',
        null=True,
        blank=True,
        help_text='ãƒ”ãƒ³ç•™ã‚ã•ã‚ŒãŸæ—¥æ™‚'
    )
    pin_expires_at = models.DateTimeField(
        verbose_name='ãƒ”ãƒ³ç•™ã‚æœŸé™',
        null=True,
        blank=True,
        help_text='ãƒ”ãƒ³ç•™ã‚ãŒè‡ªå‹•è§£é™¤ã•ã‚Œã‚‹æ—¥æ™‚'
    )
    created_at = models.DateTimeField(
        verbose_name='æŠ•ç¨¿æ—¥æ™‚',
        auto_now_add=True
    )
    updated_at = models.DateTimeField(
        verbose_name='æ›´æ–°æ—¥æ™‚',
        auto_now=True
    )
    
    class Meta:
        verbose_name = 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'
        verbose_name_plural = 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'
        ordering = [
            '-is_pinned',  # ãƒ”ãƒ³ç•™ã‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸Šä½ã«
            '-pin_duration_hours',  # ãƒ”ãƒ³ç•™ã‚æœŸé–“ãŒé•·ã„é †
            '-pinned_at',  # ãƒ”ãƒ³ç•™ã‚æ—¥æ™‚ãŒæ–°ã—ã„é †
            '-created_at'  # é€šå¸¸ã®æŠ•ç¨¿æ—¥æ™‚é †
        ]
        
    def __str__(self):
        return f"{self.user.name}: {self.content[:50]}..."
        
    def get_reaction_counts(self):
        """å„ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æ•°ã‚’å–å¾—"""
        from django.db.models import Count
        return self.reactions.values('reaction_type').annotate(count=Count('reaction_type'))
        
    def is_pin_expired(self):
        """ãƒ”ãƒ³ç•™ã‚ãŒæœŸé™åˆ‡ã‚Œã‹ã©ã†ã‹ã‚’åˆ¤å®š"""
        if not self.is_pinned or not self.pin_expires_at:
            return False
        from django.utils import timezone
        import pytz
        jst = pytz.timezone('Asia/Tokyo')
        return timezone.now().astimezone(jst) > self.pin_expires_at
        
    def pin_message(self, duration_hours):
        """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ”ãƒ³ç•™ã‚ã™ã‚‹"""
        from django.utils import timezone
        from datetime import timedelta
        import pytz
        
        jst = pytz.timezone('Asia/Tokyo')
        self.is_pinned = True
        self.pin_duration_hours = duration_hours
        self.pinned_at = timezone.now().astimezone(jst)
        self.pin_expires_at = self.pinned_at + timedelta(hours=duration_hours)
        self.save()
        
    def unpin_message(self):
        """ãƒ”ãƒ³ç•™ã‚ã‚’è§£é™¤ã™ã‚‹"""
        self.is_pinned = False
        self.pin_duration_hours = None
        self.pinned_at = None
        self.pin_expires_at = None
        self.save()
        
    def get_pin_remaining_time(self):
        """ãƒ”ãƒ³ç•™ã‚ã®æ®‹ã‚Šæ™‚é–“ã‚’å–å¾—ï¼ˆç§’å˜ä½ï¼‰"""
        if not self.is_pinned or not self.pin_expires_at:
            return 0
        from django.utils import timezone
        import pytz
        jst = pytz.timezone('Asia/Tokyo')
        remaining = self.pin_expires_at - timezone.now().astimezone(jst)
        return max(0, remaining.total_seconds())
```

### 2. Reaction ãƒ¢ãƒ‡ãƒ«
```python
class Reaction(models.Model):
    """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³"""
    
    REACTION_CHOICES = [
        ('thumbs_up', 'ğŸ‘'),
        ('heart', 'â¤ï¸'),
        ('laughing', 'ğŸ˜‚'),
        ('surprised', 'ğŸ˜®'),
    ]
    
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='reactions',
        verbose_name='ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼'
    )
    message = models.ForeignKey(
        Message,
        on_delete=models.CASCADE,
        related_name='reactions',
        verbose_name='å¯¾è±¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'
    )
    reaction_type = models.CharField(
        max_length=20,
        choices=REACTION_CHOICES,
        verbose_name='ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®é¡'
    )
    created_at = models.DateTimeField(
        verbose_name='ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ—¥æ™‚',
        auto_now_add=True
    )
    
    class Meta:
        verbose_name = 'ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³'
        verbose_name_plural = 'ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³'
        unique_together = ('user', 'message', 'reaction_type')  # åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»åŒä¸€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ»åŒä¸€ç¨®é¡ã®é‡è¤‡é˜²æ­¢
        ordering = ['-created_at']
        
    def __str__(self):
        return f"{self.user.name} â†’ {self.get_reaction_type_display()} â†’ {self.message.content[:30]}"
        
    def get_emoji(self):
        """çµµæ–‡å­—ã‚’å–å¾—"""
        return dict(self.REACTION_CHOICES)[self.reaction_type]
```

## URLè¨­è¨ˆ

### URLãƒ‘ã‚¿ãƒ¼ãƒ³
```python
# bulletin_board/urls.py
urlpatterns = [
    path('', views.message_list, name='message_list'),           # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ãƒ»æŠ•ç¨¿
    path('message/<int:message_id>/', views.message_detail, name='message_detail'),  # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è©³ç´°
    path('api/reaction/', views.toggle_reaction, name='toggle_reaction'),           # ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆAPI
    path('api/reaction-users/<int:message_id>/<str:reaction_type>/', views.get_reaction_users, name='get_reaction_users'),  # ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§API
    path('api/pin/', views.toggle_pin, name='toggle_pin'),                         # ãƒ”ãƒ³ç•™ã‚åˆ‡ã‚Šæ›¿ãˆAPI
    path('api/pin-status/<int:message_id>/', views.get_pin_status, name='get_pin_status'),  # ãƒ”ãƒ³ç•™ã‚çŠ¶æ…‹å–å¾—API
]
```

### ãƒ¡ã‚¤ãƒ³URLçµ±åˆ
```python
# motitasu/urls.py ã«è¿½åŠ 
path('bulletin/', include('bulletin_board.urls')),
```

## ãƒ“ãƒ¥ãƒ¼è¨­è¨ˆ

### 1. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ãƒ»æŠ•ç¨¿ãƒ“ãƒ¥ãƒ¼
```python
@login_required
def message_list(request):
    """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§è¡¨ç¤ºãƒ»æŠ•ç¨¿å‡¦ç†"""
    
    if request.method == 'POST':
        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿å‡¦ç†
        content = request.POST.get('content', '').strip()
        if content:
            Message.objects.create(user=request.user, content=content)
            messages.success(request, 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ã¾ã—ãŸã€‚')
        else:
            messages.error(request, 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚')
        return redirect('message_list')
    
    # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§å–å¾—ï¼ˆãƒšãƒ¼ã‚¸ãƒ³ã‚°å¯¾å¿œï¼‰
    message_list = Message.objects.select_related('user').prefetch_related('reactions')
    paginator = Paginator(message_list, 20)  # 20ä»¶ãšã¤è¡¨ç¤º
    page_number = request.GET.get('page')
    page_obj = paginator.get_page(page_number)
    
    # å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’æ•´ç†
    for message in page_obj:
        message.reaction_summary = get_reaction_summary(message)
        if request.user.is_authenticated:
            message.user_reactions = get_user_reactions(message, request.user)
    
    context = {
        'page_obj': page_obj,
        'reaction_choices': Reaction.REACTION_CHOICES,
    }
    
    return render(request, 'bulletin_board/message_list.html', context)
```

### 2. ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆAPI
```python
@login_required
@require_POST
def toggle_reaction(request):
    """ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆï¼ˆAjax APIï¼‰"""
    
    try:
        message_id = request.POST.get('message_id')
        reaction_type = request.POST.get('reaction_type')
        
        message = Message.objects.get(id=message_id)
        
        # æ—¢å­˜ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
        existing_reaction = Reaction.objects.filter(
            user=request.user,
            message=message,
            reaction_type=reaction_type
        ).first()
        
        if existing_reaction:
            # æ—¢å­˜ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
            existing_reaction.delete()
            action = 'removed'
        else:
            # æ–°è¦ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
            Reaction.objects.create(
                user=request.user,
                message=message,
                reaction_type=reaction_type
            )
            action = 'added'
        
        # æ›´æ–°å¾Œã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚’å–å¾—
        reaction_count = message.reactions.filter(reaction_type=reaction_type).count()
        
        return JsonResponse({
            'success': True,
            'action': action,
            'reaction_count': reaction_count
        })
        
    except Exception as e:
        return JsonResponse({
            'success': False,
            'error': str(e)
        })
```

### 3. ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§API
```python
def get_reaction_users(request, message_id, reaction_type):
    """ç‰¹å®šãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’å–å¾—"""
    import pytz
    
    try:
        message = Message.objects.get(id=message_id)
        reactions = message.reactions.filter(reaction_type=reaction_type).select_related('user')
        
        jst = pytz.timezone('Asia/Tokyo')
        user_list = [
            {
                'name': reaction.user.name,
                'created_at': reaction.created_at.astimezone(jst).strftime('%Y-%m-%d %H:%M')
            }
            for reaction in reactions
        ]
        
        return JsonResponse({
            'success': True,
            'users': user_list,
            'emoji': dict(Reaction.REACTION_CHOICES)[reaction_type]
        })
        
    except Exception as e:
        return JsonResponse({
            'success': False,
            'error': str(e)
        })
```

### 4. ãƒ”ãƒ³ç•™ã‚åˆ‡ã‚Šæ›¿ãˆAPI
```python
@login_required
@require_POST
def toggle_pin(request):
    """ãƒ”ãƒ³ç•™ã‚ã®åˆ‡ã‚Šæ›¿ãˆï¼ˆAjax APIï¼‰"""
    import pytz
    
    try:
        message_id = request.POST.get('message_id')
        action = request.POST.get('action')  # 'pin' or 'unpin'
        
        message = Message.objects.get(id=message_id, user=request.user)  # è‡ªåˆ†ã®æŠ•ç¨¿ã®ã¿
        jst = pytz.timezone('Asia/Tokyo')
        
        if action == 'pin':
            duration = int(request.POST.get('duration', 24))  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ24æ™‚é–“
            if duration not in [12, 24, 168]:
                duration = 24
            
            message.pin_message(duration)
            return JsonResponse({
                'success': True,
                'action': 'pinned',
                'duration': duration,
                'expires_at': message.pin_expires_at.astimezone(jst).isoformat()
            })
            
        elif action == 'unpin':
            message.unpin_message()
            return JsonResponse({
                'success': True,
                'action': 'unpinned'
            })
        
        else:
            return JsonResponse({
                'success': False,
                'error': 'Invalid action'
            })
        
    except Message.DoesNotExist:
        return JsonResponse({
            'success': False,
            'error': 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€ç·¨é›†æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚'
        })
    except Exception as e:
        return JsonResponse({
            'success': False,
            'error': str(e)
        })
```

### 5. ãƒ”ãƒ³ç•™ã‚çŠ¶æ…‹å–å¾—API
```python
def get_pin_status(request, message_id):
    """ãƒ”ãƒ³ç•™ã‚çŠ¶æ…‹ã‚’å–å¾—"""
    import pytz
    
    try:
        message = Message.objects.get(id=message_id)
        jst = pytz.timezone('Asia/Tokyo')
        
        return JsonResponse({
            'success': True,
            'is_pinned': message.is_pinned,
            'pin_duration_hours': message.pin_duration_hours,
            'pinned_at': message.pinned_at.astimezone(jst).isoformat() if message.pinned_at else None,
            'pin_expires_at': message.pin_expires_at.astimezone(jst).isoformat() if message.pin_expires_at else None,
            'remaining_seconds': message.get_pin_remaining_time(),
            'is_expired': message.is_pin_expired()
        })
        
    except Message.DoesNotExist:
        return JsonResponse({
            'success': False,
            'error': 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚'
        })
    except Exception as e:
        return JsonResponse({
            'success': False,
            'error': str(e)
        })
```

### 6. ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
```python
def get_reaction_summary(message):
    """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚’å–å¾—"""
    reaction_counts = message.get_reaction_counts()
    summary = {}
    for reaction in reaction_counts:
        summary[reaction['reaction_type']] = reaction['count']
    return summary

def get_user_reactions(message, user):
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã—ãŸãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—"""
    user_reactions = message.reactions.filter(user=user)
    return [reaction.reaction_type for reaction in user_reactions]
```

### 7. è‡ªå‹•ãƒ”ãƒ³ç•™ã‚è§£é™¤ã‚¿ã‚¹ã‚¯ç”¨ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒãƒ³ãƒ‰
```python
# bulletin_board/management/commands/cleanup_expired_pins.py
from django.core.management.base import BaseCommand
from django.utils import timezone
import pytz
from bulletin_board.models import Message

class Command(BaseCommand):
    help = 'æœŸé™åˆ‡ã‚Œã®ãƒ”ãƒ³ç•™ã‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªå‹•è§£é™¤'
    
    def handle(self, *args, **options):
        jst = pytz.timezone('Asia/Tokyo')
        now = timezone.now().astimezone(jst)
        expired_messages = Message.objects.filter(
            is_pinned=True,
            pin_expires_at__lte=now
        )
        
        count = 0
        for message in expired_messages:
            message.unpin_message()
            count += 1
        
        self.stdout.write(
            self.style.SUCCESS(f'æˆåŠŸ: {count}ä»¶ã®æœŸé™åˆ‡ã‚Œãƒ”ãƒ³ç•™ã‚ã‚’è§£é™¤ã—ã¾ã—ãŸã€‚')
        )
```

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¨­è¨ˆ

### 1. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```html
<!-- templates/bulletin_board/message_list.html -->
{% extends 'base.html' %}
{% load tz %}

{% block title %}ä¼è¨€æ¿ - Motitasu{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'bulletin_board/css/bulletin_board.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>ä¼è¨€æ¿</h2>
    
    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
    {% if user.is_authenticated %}
    <div class="card mb-4">
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                    <textarea class="form-control" name="content" rows="3" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." maxlength="1000" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">æŠ•ç¨¿</button>
            </form>
        </div>
    </div>
    {% endif %}
    
    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ -->
    <div id="message-list">
        {% for message in page_obj %}
        <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <strong>{{ message.user.name }}</strong>
                    {% timezone "Asia/Tokyo" %}
                    <small class="text-muted">{{ message.created_at|date:"Yå¹´mæœˆdæ—¥ H:i" }}</small>
                    {% endtimezone %}
                </div>
                <p class="card-text">{{ message.content|linebreaks }}</p>
                
                <!-- ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ -->
                <div class="reaction-area" data-message-id="{{ message.id }}">
                    {% for reaction_type, emoji in reaction_choices %}
                    <button class="reaction-btn btn btn-outline-secondary btn-sm me-1 mb-1" 
                            data-reaction-type="{{ reaction_type }}"
                            {% if not user.is_authenticated %}disabled{% endif %}>
                        {{ emoji }}
                        <span class="reaction-count">{{ message.reaction_summary|get_item:reaction_type|default:0 }}</span>
                    </button>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="alert alert-info">
            ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
        </div>
        {% endfor %}
    </div>
    
    <!-- ãƒšãƒ¼ã‚¸ãƒ³ã‚° -->
    {% if page_obj.has_other_pages %}
    <nav aria-label="ãƒšãƒ¼ã‚¸ãƒ³ã‚°">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">å‰ã¸</a>
            </li>
            {% endif %}
            
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                <li class="page-item active">
                    <span class="page-link">{{ num }}</span>
                </li>
                {% else %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
                {% endif %}
            {% endfor %}
            
            {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">æ¬¡ã¸</a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'bulletin_board/js/bulletin_board.js' %}"></script>
{% endblock %}
```

### 2. JavaScriptè¨­è¨ˆ
```javascript
// static/bulletin_board/js/bulletin_board.js
document.addEventListener('DOMContentLoaded', function() {
    // ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    document.querySelectorAll('.reaction-btn').forEach(button => {
        button.addEventListener('click', function() {
            const messageId = this.closest('.reaction-area').dataset.messageId;
            const reactionType = this.dataset.reactionType;
            
            fetch('/bulletin/api/reaction/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': getCsrfToken()
                },
                body: `message_id=${messageId}&reaction_type=${reactionType}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚’æ›´æ–°
                    const countSpan = this.querySelector('.reaction-count');
                    countSpan.textContent = data.reaction_count;
                    
                    // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
                    if (data.action === 'added') {
                        this.classList.remove('btn-outline-secondary');
                        this.classList.add('btn-secondary');
                    } else {
                        this.classList.remove('btn-secondary');
                        this.classList.add('btn-outline-secondary');
                    }
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            });
        });
    });
});

function getCsrfToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]').value;
}
```

## CSSè¨­è¨ˆ
```css
/* static/bulletin_board/css/bulletin_board.css */
.reaction-area {
    border-top: 1px solid #e9ecef;
    padding-top: 0.75rem;
    margin-top: 1rem;
}

.reaction-btn {
    font-size: 0.875rem;
    padding: 0.25rem 0.5rem;
    border-radius: 1rem;
    transition: all 0.2s ease;
}

.reaction-btn:hover {
    transform: scale(1.05);
}

.reaction-count {
    font-size: 0.75rem;
    margin-left: 0.25rem;
}

.message-card {
    transition: box-shadow 0.2s ease;
}

.message-card:hover {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}
```

## ç®¡ç†ç”»é¢è¨­å®š
```python
# bulletin_board/admin.py
from django.contrib import admin
from .models import Message, Reaction

@admin.register(Message)
class MessageAdmin(admin.ModelAdmin):
    list_display = ('user', 'content_preview', 'is_pinned', 'pin_duration_hours', 'created_at')
    list_filter = ('created_at', 'user', 'is_pinned', 'pin_duration_hours')
    search_fields = ('content', 'user__name')
    readonly_fields = ('created_at', 'updated_at', 'pinned_at', 'pin_expires_at')
    actions = ['bulk_unpin_messages']
    
    def bulk_unpin_messages(self, request, queryset):
        """é¸æŠã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ”ãƒ³ç•™ã‚ã‚’ä¸€æ‹¬è§£é™¤"""
        count = 0
        for message in queryset.filter(is_pinned=True):
            message.unpin_message()
            count += 1
        self.message_user(request, f'{count}ä»¶ã®ãƒ”ãƒ³ç•™ã‚ã‚’è§£é™¤ã—ã¾ã—ãŸã€‚')
    bulk_unpin_messages.short_description = 'é¸æŠã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ”ãƒ³ç•™ã‚ã‚’è§£é™¤'
    
    def content_preview(self, obj):
        return obj.content[:50] + "..." if len(obj.content) > 50 else obj.content
    content_preview.short_description = 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹'

@admin.register(Reaction)
class ReactionAdmin(admin.ModelAdmin):
    list_display = ('user', 'message_preview', 'get_emoji', 'created_at')
    list_filter = ('reaction_type', 'created_at')
    search_fields = ('user__name', 'message__content')
    
    def message_preview(self, obj):
        return obj.message.content[:30] + "..." if len(obj.message.content) > 30 else obj.message.content
    message_preview.short_description = 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'
```

## ãƒãƒƒãƒå‡¦ç†è¨­å®š

### 1. å®šæœŸã‚¿ã‚¹ã‚¯è¨­å®šï¼ˆcrontabï¼‰
```bash
# æœŸé™åˆ‡ã‚Œãƒ”ãƒ³ç•™ã‚ã®è‡ªå‹•è§£é™¤ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
# æ–¯åˆ†å®Ÿè¡Œ
*/5 * * * * cd /path/to/motitasu && python manage.py cleanup_expired_pins

# ãƒ†ã‚¹ãƒˆç’°å¢ƒç”¨ï¼ˆæ™‚é–“å®Ÿè¡Œï¼‰
0 * * * * cd /path/to/motitasu && python manage.py cleanup_expired_pins
```

### 2. Djangoè¨­å®šã§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©å¯¾å¿œ
```python
# settings.py
INSTALLED_APPS = [
    # ...
    'django_crontab',  # django-crontabãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½¿ç”¨æ™‚
    'bulletin_board',
    # ...
]

# ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®šï¼ˆJSTï¼‰
TIME_ZONE = 'Asia/Tokyo'
USE_TZ = True

# Crontabè¨­å®š
CRONTAB_JOBS = [
    ('*/5 * * * *', 'bulletin_board.cron.cleanup_expired_pins'),
]
```

## å®Ÿè£…é †åº
1. Djangoã‚¢ãƒ—ãƒªä½œæˆï¼ˆ`python manage.py startapp bulletin_board`ï¼‰
2. ãƒ¢ãƒ‡ãƒ«å®Ÿè£…ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
3. ç®¡ç†ç”»é¢è¨­å®š
4. URLè¨­å®š
5. ãƒ“ãƒ¥ãƒ¼å®Ÿè£…ï¼ˆãƒ”ãƒ³ç•™ã‚æ©Ÿèƒ½ã€ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€APIå«ã‚€ï¼‰
6. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£…ï¼ˆãƒã‚¹ãƒˆã‚¤ãƒƒãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰
7. é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCSS/JSï¼‰å®Ÿè£…ï¼ˆãƒã‚¹ãƒˆã‚¤ãƒƒãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã€ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ï¼‰
8. ãƒ¡ã‚¤ãƒ³navigationã«ä¼è¨€æ¿ãƒªãƒ³ã‚¯è¿½åŠ 
9. ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒãƒ³ãƒ‰å®Ÿè£…ï¼ˆãƒ”ãƒ³ç•™ã‚è‡ªå‹•è§£é™¤ï¼‰
10. å®šæœŸã‚¿ã‚¹ã‚¯è¨­å®šï¼ˆcrontabã¾ãŸã¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ï¼‰

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
- CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®é©åˆ‡ãªä½¿ç”¨
- XSSå¯¾ç­–ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã®é©åˆ‡ãªã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰
- SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆORMã®é©åˆ‡ãªä½¿ç”¨ï¼‰
- ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã®æŠ•ç¨¿ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ¶é™

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …
- select_related/prefetch_relatedã®æ´»ç”¨
- ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
- Ajaxã«ã‚ˆã‚‹éƒ¨åˆ†æ›´æ–°ï¼ˆãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒ”ãƒ³ç•™ã‚ï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®é©åˆ‡ãªè¨­å®šï¼ˆis_pinned, created_at, pin_expires_atï¼‰
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—ã®ãƒãƒƒãƒå‡¦ç†ï¼ˆ20ä»¶ãšã¤ï¼‰
- CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€é©åŒ–ï¼ˆtransform, transitionï¼‰

## ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œï¼‰
- ãƒã‚¹ãƒˆã‚¤ãƒƒãƒˆã®è¦–è¦šçš„å¤šæ§˜æ€§ï¼ˆè‰²ã€å›è»¢è§’åº¦ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®æ˜ç¢ºãªè¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªè¡¨ç¤º
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£é…æ…®ï¼ˆaria-labelã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰