{% extends 'base.html' %}

{% block title %}ä¼è¨€æ¿{% endblock %}

{% block content %}
<h1>ä¼è¨€æ¿</h1>

<!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
{% if user.is_authenticated %}
<form method="post">
    {% csrf_token %}
    <textarea name="content" rows="3" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›" maxlength="200" required></textarea><br>
    <button type="submit">æŠ•ç¨¿</button>
</form>
<hr>
{% endif %}

<!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ -->
{% for message in page_obj %}
<div style="border: 1px solid #ccc; margin: 10px 0; padding: 10px;">
    <div>
        <strong>{{ message.user.name }}</strong>
        <span>{{ message.created_at|date:"Y-m-d H:i" }}</span>
    </div>
    
    <!-- ãƒ”ãƒ³ç•™ã‚è¡¨ç¤º -->
    {% if message.is_pinned %}
    <div>ğŸ“Œ ãƒ”ãƒ³ç•™ã‚ä¸­ {% if message.pin_expires_at %}({{ message.pin_expires_at|date:"m/d H:i" }}ã¾ã§){% endif %}</div>
    {% endif %}
    
    <p>{{ message.content|linebreaks }}</p>
    
    <!-- ãƒ”ãƒ³ç•™ã‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    {% if message.user == user %}
    <div class="pin-controls" data-message-id="{{ message.id }}">
        {% if message.is_pinned %}
        <button class="unpin-btn">ãƒ”ãƒ³ç•™ã‚è§£é™¤</button>
        {% else %}
        <button class="pin-btn" data-duration="12">12æ™‚é–“ãƒ”ãƒ³ç•™ã‚</button>
        <button class="pin-btn" data-duration="24">24æ™‚é–“ãƒ”ãƒ³ç•™ã‚</button>
        <button class="pin-btn" data-duration="168">1é€±é–“ãƒ”ãƒ³ç•™ã‚</button>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ -->
    <div class="reaction-area" data-message-id="{{ message.id }}">
        {% for reaction_type, emoji in reaction_choices %}
        <button class="reaction-btn" data-reaction-type="{{ reaction_type }}" 
                {% if not user.is_authenticated %}disabled{% endif %}>
            {{ emoji }} 
            <span class="reaction-count">
                {% for reaction in message.reaction_summary.items %}
                    {% if reaction.0 == reaction_type %}{{ reaction.1 }}{% endif %}
                {% empty %}0{% endfor %}
            </span>
        </button>
        {% endfor %}
    </div>
</div>
{% empty %}
<p>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
{% endfor %}

<!-- ãƒšãƒ¼ã‚¸ãƒ³ã‚° -->
{% if page_obj.has_other_pages %}
<div>
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}">å‰ã¸</a>
    {% endif %}
    
    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
        <strong>{{ num }}</strong>
        {% else %}
        <a href="?page={{ num }}">{{ num }}</a>
        {% endif %}
    {% endfor %}
    
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}">æ¬¡ã¸</a>
    {% endif %}
</div>
{% endif %}

<!-- Bootstrap ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal fade" id="reactionUsersModal" tabindex="-1" aria-labelledby="reactionUsersModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reactionUsersModalLabel">ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼<!-- ã‚¿ã‚¤ãƒˆãƒ«ã¯å‹•çš„ã«å¤‰æ›´ã•ã‚Œã¾ã™ --></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é–‰ã˜ã‚‹"></button>
            </div>
            <div class="modal-body">
                <div id="reactionUsersList">
                    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆãŒã“ã“ã«å‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% load static %}
<script src="{% static 'bulletin_board/js/bulletin_board.js' %}"></script>
{% endblock %}